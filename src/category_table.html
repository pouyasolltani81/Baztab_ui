<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Categories</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6 font-sans">

  <div class="container mx-auto">
    <!-- Category Dropdown -->
    <div class="mb-4">
      <div class="flex items-center space-x-3">
        <label for="category" class="text-xl font-semibold text-teal-600">Select Top-level Category:</label>
        <select id="category" class="py-2 px-4 border border-teal-400 rounded-lg focus:ring-2 focus:ring-teal-500 text-lg">
          <!-- Categories will be populated dynamically -->
        </select>
      </div>
    </div>

    <!-- Table for Categories and Subcategories -->
    <div class="overflow-x-auto bg-white shadow-md rounded-lg">
      <table class="min-w-full table-auto">
        <thead class="bg-teal-600 text-white">
          <tr id="categoryTableHeader">
            <!-- Column headers will be populated dynamically -->
          </tr>
        </thead>
        <tbody id="categoryTableBody">
          <!-- Dynamic rows will be injected here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Sample Data (Simulating the API response structure)
    const responseData = {
      "return": true,
      "message": "ok",
      "data": {
        "Saleman_bot": {
          "زیبایی و سلامت": {
            "_id": "67358d34fd1372fc4a6d61a8",
            "name_fa": "زیبایی و سلامت",
            "parent_id": null,
            "slug": "",
            "slug_fa": "زیبایی-و-سلامت",
            "level": 1,
            "created_at": "2024-11-14T05:40:04.262",
            "level_2": [
              {
                "_id": "67358d34fd1372fc4a6d61a9",
                "name_fa": "لوازم آرایشی",
                "parent_id": "67358d34fd1372fc4a6d61a8",
                "slug": " > ",
                "slug_fa": "لوازم-آرایشی < زیبایی-و-سلامت",
                "level": 2,
                "created_at": "2024-11-14T05:40:04.266",
                "level_3": [
                  {
                    "_id": "67358d34fd1372fc4a6d61aa",
                    "name_fa": "کرم پودر",
                    "parent_id": "67358d34fd1372fc4a6d61a9",
                    "slug": " >  > ",
                    "slug_fa": "کرم-پودر < لوازم-آرایشی < زیبایی-و-سلامت",
                    "level": 3,
                    "created_at": "2024-11-14T05:40:04.267",
                    "updatedAt": "2024-11-25T14:13:18.929"
                  },
                  {
                    "_id": "673839a3fd1372fc4a6d9518",
                    "name_fa": "پنکک",
                    "parent_id": "67358d34fd1372fc4a6d61a9",
                    "slug": " >  > ",
                    "slug_fa": "پنکک < لوازم-آرایشی < زیبایی-و-سلامت",
                    "level": 3,
                    "created_at": "2024-11-16T06:20:19.766",
                    "updatedAt": "2024-11-25T14:13:22.126"
                  },
                  {
                    "_id": "6739e5ddfd1372fc4a6db9b1",
                    "name_fa": "کانسیلر",
                    "parent_id": "67358d34fd1372fc4a6d61a9",
                    "slug": " >  > ",
                    "slug_fa": "کانسیلر < لوازم-آرایشی < زیبایی-و-سلامت",
                    "level": 3,
                    "created_at": "2024-11-17T12:47:25.775",
                    "updatedAt": "2024-11-25T14:13:23.275"
                  }
                ]
              }
            ]
          },
          "آرایشی": {
            "_id": "67448822d972c672ef18407b",
            "name_fa": "آرایشی",
            "parent_id": null,
            "slug": "test",
            "slug_fa": "آرایشی",
            "level": 1,
            "created_at": "2024-11-25T14:22:26.961",
            "level_2": [
              {
                "_id": "67448822d972c672ef18407c",
                "name_fa": "آرایش صورت",
                "parent_id": "67448822d972c672ef18407b",
                "slug": "test > ",
                "slug_fa": "آرایش-صورت < آرایشی",
                "level": 2,
                "created_at": "2024-11-25T14:22:26.964",
                "level_3": [
                  {
                    "_id": "67448822d972c672ef18407d",
                    "name_fa": "پودر فیکس",
                    "parent_id": "67448822d972c672ef18407c",
                    "slug": "test >  > ",
                    "slug_fa": "پودر-فیکس < آرایش-صورت < آرایشی",
                    "level": 3,
                    "created_at": "2024-11-25T14:22:26.967"
                  }
                ]
              }
            ]
          }
        }
      }
    };

    let currentCategory = "زیبایی و سلامت"; // Default initial category

    // Render categories in the dropdown
    function renderCategoryDropdown() {
      const categoryDropdown = document.getElementById('category');
      categoryDropdown.innerHTML = ''; // Clear previous options

      // Dynamically populate categories in the dropdown (only level 1 categories)
      Object.values(responseData.data).forEach(category => {
        Object.values(category).forEach(mainCategory => {
          const option = document.createElement('option');
          option.value = mainCategory.name_fa; // Set value to the category's name in Farsi (e.g., زیبایی و سلامت)
          option.innerHTML = mainCategory.name_fa; // Set display name to the category's name in Farsi
          categoryDropdown.appendChild(option);
        });
      });

      // Trigger the table render when a category is selected
      categoryDropdown.addEventListener('change', (e) => {
        currentCategory = e.target.value;
        renderTable();
      });
    }

    // Render the table for categories and subcategories
    function renderTable() {
      const categoryTableBody = document.getElementById('categoryTableBody');
      const categoryTableHeader = document.getElementById('categoryTableHeader');
      categoryTableBody.innerHTML = '';
      categoryTableHeader.innerHTML = '';

      // Find the selected top-level category
      const selectedCategory = Object.values(responseData.data).find(category =>
        Object.keys(category).includes(currentCategory)
      );

      if (!selectedCategory) return; // If category not found, exit

      const mainCategory = selectedCategory[currentCategory]; // Get the main category object
      const subcategories = mainCategory.level_2 || []; // Get the second level subcategories

      // Render the header row based on the subcategory levels (dynamic number of columns)
      categoryTableHeader.innerHTML = `
        <th class="py-2 px-4 text-left text-lg font-medium">Category</th>
        <th class="py-2 px-4 text-left text-lg font-medium">Level 2</th>
        ${subcategories.some(sub => sub.level_3) ? '<th class="py-2 px-4 text-left text-lg font-medium">Level 3</th>' : ''}
      `;

      // Render the rows for each subcategory
      subcategories.forEach(subcategory => {
        const level3Subcategories = subcategory.level_3 || [];
        categoryTableBody.innerHTML += `
          <tr class="border-b">
            <td class="py-2 px-4 font-semibold text-md">${currentCategory}</td>
            <td class="py-2 px-4">${renderSubcategories([subcategory], 2)}</td>
            ${level3Subcategories.length > 0 ? `<td class="py-2 px-4">${renderSubcategories(level3Subcategories, 3)}</td>` : ''}
          </tr>
        `;
      });
    }

    // Recursive function to render subcategories dynamically for each level
    function renderSubcategories(subcategories, level) {
      return subcategories.map(subcategory => {
        const buttons = `
          <div class="flex space-x-2 mt-2">
            <button class="px-3 py-1 bg-teal-500 text-white rounded-md text-sm">More Info</button>
            <button class="px-3 py-1 bg-blue-500 text-white rounded-md text-sm">Get Product</button>
            <button class="px-3 py-1 bg-green-500 text-white rounded-md text-sm">Add to Cart</button>
          </div>
        `;

        const isLastLevel = !subcategory.level_3 || subcategory.level_3.length === 0; // Check if it's the last level

        return `
          <div class="category-card p-3 border border-gray-300 rounded-lg">
            <div class="flex justify-between">
              <p class="font-semibold text-sm">${subcategory.name_fa} (ID: ${subcategory._id})</p>
              ${subcategory.updatedAt ? `<span class="text-xs text-gray-500 mt-2">Last updated at : ${subcategory.updatedAt}</span>` :  `<span class="text-xs text-gray-500 mt-2">Created  at : ${subcategory.created_at}</span>`}
            </div>
            ${buttons}
            ${isLastLevel ? '<span class="text-xs text-gray-500 mt-2">Last Level</span>' : ''}
          </div>
        `;
      }).join('');
    }

    // Initialize the page by rendering the dropdown and the table
    renderCategoryDropdown();
    renderTable();
  </script>
</body>
</html>
